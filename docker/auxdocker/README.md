# auxdocker: помогалка для разворачивания проектов локально в docker

## Создание своей сборки под проект

1. Создать папку проекта, например, `myproject/`
2. Внутри проекта создать папочку для конфигов докера (например, `myproject/aux/docker/`).
3. Добавить сервисы (mysql, php-apache и пр.), для каждого:
   1. Скопировать его в папочку.
   2. Ознакомиться с README.md сервиса для информации о возможности настройки и расширения, установки дополнений.
5. Добавить аналогичным образом сервис _base (нужен обязательно).
6. Рядом с сервисами положить `build-conf.sh`.
7. Запустить его. Он попросит выполнить дополнительные шаги конфигурации (будет ругаться на недостающие переменные и сообщать, в каких файлах их нужно разместить). Когда все будет сконфигурировано - создаст `.env` и `docker-compose.yml`.
8. Изучить получившиеся `.env` и `docker-compose.yml`, убедиться, что все ок.
9. Положить итоговые `.env` и `docker-compose.yml` конфиги в корень проекта.
10. `docker-compose up -d`
11. При необходимости скорректировать исходники сервисов, пересобрать, дорабатывать до готовности.

В результате должен получиться набор файлов, требующий минимум действий для запуска проекта (см. "Минимум действий для запуска готовой сборки проекта").

## Минимум действий для запуска готовой сборки проекта
 
1. Создать папку проекта.
2. Положить туда папочку с готовой сборкой конфигов докера (например, в `aux/docker`).
3. Подправить `aux/docker/.env._base.override`, указав там локальный IP для данного проекта.
4. Сгенерировать `.env` и `docker-compose.yml` с помощью `build-conf.sh`
5. Положить их в корень проекта.
6. Положить сами файлы проекта, скажем, в `./src`. 
7. `docker-compose up -d`
8. Готово.

## Управление сервисами

Сервисы поддерживают для управления скрипт `...docker/имя_сервиса/имя_сервиса`, например, `aux/docker/mysql/mysql`. Действие скрипта по умолчанию при запуске без аргументов зависит от сервиса. 

Как правило, сервисы поддерживают команды:

 * `docker/myservice/myservice root` - вход в контейнер от root
 * `docker/myservice/myservice rebuild` - пересборка сервиса
 * `docker/myservice/myservice restert` - рестарт сервиса

Сервисы могут поддерживать дополнительные команды, см. скрипт конкретного сервиса для дополнительной информации.

## Настройка сервисов во время выполнения

Параметры сервисов, которые можно менять вживую (без пересборки, максимум с перезапуском контейнера) описаны в README.md каждого сервиса.

## Решение проблем с конфигами

Спасибо https://stackoverflow.com/a/50166314/1775065

```
docker cp container_web_1:/etc/apache2/conf-enabled/some-settings.conf .
# ... edit some-settings.conf ...
docker cp some-settings.conf container_web_1:/etc/apache2/conf-enabled/some-settings.conf
```

## См. также

* https://github.com/frontid/dockerizer
* include+ https://github.com/edrevo/dockerfile-plus
